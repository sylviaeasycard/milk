<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Milk v3 - Stable</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
<style>
    /* æ ¸å¿ƒä¿®æ­£ï¼šè®“ body æ’æ»¿ä½†ä¸æº¢å‡º */
    body { 
        font-family:-apple-system,BlinkMacSystemFont,sans-serif; 
        background:#f8fafc; margin:0; 
        display:flex; flex-direction:column; 
        height: 100vh; height: 100dvh; 
        color:#1e293b; overflow: hidden; 
    }
    
    header { background:white; padding:12px 20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; flex-shrink: 0; }
    header h1 { margin:0; font-size:14px; font-weight:900; color:#2563eb; }
    .reset-btn { border:none; background:#f1f5f9; padding:5px 12px; border-radius:12px; font-size: 11px; font-weight:bold; color:#64748b; }
    
    /* ä¿®æ­£ï¼šmain å€å¡Šæ”¹ç‚ºå¯æ²å‹•ï¼Œæ‡‰å°éµç›¤å½ˆå‡º */
    main { 
        flex:1; display: flex; flex-direction: column; 
        padding: 10px; gap: 10px; 
        overflow-y: auto; /* ç•¶ç©ºé–“ä¸è¶³æ™‚å…è¨±æ²å‹• */
        -webkit-overflow-scrolling: touch;
    }
    
    /* ä¿®æ­£ï¼šå›ºå®šå¡ç‰‡é«˜åº¦ï¼Œé¿å…è®Šå½¢ */
    .card { 
        background:white; border-radius:16px; padding:15px; 
        border: 2px solid #e2e8f0; transition: 0.2s;
        display: flex; flex-direction: column; gap: 8px;
        min-height: 120px; /* å›ºå®šæœ€å°é«˜åº¦ï¼Œç¢ºä¿ reset å¾Œå¤§å°ä¸è®Š */
        flex-shrink: 0; /* ç¦æ­¢è¢«æ“ å£“ */
    }
    .card.active-side { border-color: #2563eb; background: #eff6ff; box-shadow: 0 4px 10px rgba(37,99,235,0.06); }
    
    .label { font-size:11px; font-weight:900; color:#94a3b8; display: flex; justify-content: space-between; }
    .active-tag { color: #2563eb; font-size: 10px; visibility: hidden; }
    .active-side .active-tag { visibility: visible; }

    .vol-row { display: flex; align-items: baseline; gap: 8px; height: 28px; }
    .vol-num { font-size:22px; font-weight:900; }
    .combo-area { display:flex; align-items: center; gap:2px; overflow-x: auto; white-space: nowrap; flex: 1; }
    
    input { width:100%; border:none; border-radius:10px; padding:10px 12px; font-size:20px; font-weight:900; background:#f1f5f9; box-sizing: border-box; outline: none; transition: 0.2s; }
    input:focus { background: #e2e8f0; }
    .unit-price { font-size: 13px; font-weight: 800; color: #64748b; height: 20px; text-align: right; }

    /* ä¿®æ­£åº•éƒ¨ï¼šç¢ºä¿åœ¨éµç›¤å½ˆå‡ºæ™‚ä¸ä½”ç”¨ main çš„æ²å‹•ç©ºé–“ */
    .bottom-bar { background:white; padding:10px 10px 25px; border-top:1px solid #eee; flex-shrink: 0; z-index: 10; }
    .win-msg { text-align:center; font-weight:900; margin-bottom:8px; font-size: 15px; color: #94a3b8; }
    
    .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

    .milk-card {
        background: #f8fafc; border-radius: 12px; padding: 8px 12px;
        display: flex; align-items: center; justify-content: space-between;
        border: 1px solid #e2e8f0;
    }
    .milk-card.active { border-color: #2563eb; background: #f0f7ff; }
    .card-info { display: flex; align-items: center; gap: 6px; }
    .size-label { font-size: 13px; font-weight: 900; color: #475569; }
    
    .qty-control { display:flex; align-items:center; gap:10px; }
    .qty-control button { width:30px; height:30px; border-radius:8px; border:none; background:white; box-shadow: 0 2px 4px rgba(0,0,0,0.08); font-weight:900; font-size: 18px; color: #2563eb; }
    .qty-control span { min-width:12px; font-weight:900; font-size: 15px; }
</style>
</head>
<body>

<header>
    <h1>MILK v3.1</h1>
    <button class="reset-btn" onclick="softReset()">RESET</button>
</header>

<main id="scroll-main">
    <div class="card active-side" id="side-card-1" onclick="switchSide(1)">
        <div class="label">æ–¹æ¡ˆ A <span class="active-tag">â— ä¿®æ”¹ä¸­</span></div>
        <div class="vol-row">
            <div class="vol-num"><span id="vol-1">0</span> <small style="font-size:12px">ml</small></div>
            <div class="combo-area" id="list-1"></div>
        </div>
        <input type="number" id="price-1" inputmode="decimal" placeholder="è¼¸å…¥ A åƒ¹æ ¼" oninput="calc()" onclick="event.stopPropagation()">
        <div class="unit-price" id="unit-1"></div>
    </div>

    <div class="card" id="side-card-2" onclick="switchSide(2)">
        <div class="label">æ–¹æ¡ˆ B <span class="active-tag">â— ä¿®æ”¹ä¸­</span></div>
        <div class="vol-row">
            <div class="vol-num"><span id="vol-2">0</span> <small style="font-size:12px">ml</small></div>
            <div class="combo-area" id="list-2"></div>
        </div>
        <input type="number" id="price-2" inputmode="decimal" placeholder="è¼¸å…¥ B åƒ¹æ ¼" oninput="calc()" onclick="event.stopPropagation()">
        <div class="unit-price" id="unit-2"></div>
    </div>
</main>

<div class="bottom-bar">
    <div class="win-msg" id="win-text">READY</div>
    <div class="btn-grid">
        <div class="milk-card" id="card-230">
            <div class="card-info">
                <svg width="12" height="18" viewBox="0 0 40 50"><path d="M10 15 L20 5 L30 15 L30 45 L10 45 Z" fill="#eff6ff" stroke="#3b82f6" stroke-width="4"/></svg>
                <span class="size-label">230</span>
            </div>
            <div class="qty-control">
                <button onclick="event.stopPropagation(); change(230,-1)" id="btn-230-minus">âˆ’</button>
                <span id="count-230">0</span>
                <button onclick="event.stopPropagation(); change(230,1)">ï¼‹</button>
            </div>
        </div>
        <div class="milk-card" id="card-468">
            <div class="card-info">
                <svg width="12" height="18" viewBox="0 0 40 60"><path d="M10 15 L20 5 L30 15 L30 55 L10 55 Z" fill="#ecfdf5" stroke="#22c55e" stroke-width="4"/></svg>
                <span class="size-label">468</span>
            </div>
            <div class="qty-control">
                <button onclick="event.stopPropagation(); change(468,-1)" id="btn-468-minus">âˆ’</button>
                <span id="count-468">0</span>
                <button onclick="event.stopPropagation(); change(468,1)">ï¼‹</button>
            </div>
        </div>
        <div class="milk-card" id="card-936">
            <div class="card-info">
                <svg width="14" height="18" viewBox="0 0 50 70"><path d="M8 15 L25 5 L42 15 L42 65 L8 65 Z" fill="#fff7ed" stroke="#f59e0b" stroke-width="4"/></svg>
                <span class="size-label">936</span>
            </div>
            <div class="qty-control">
                <button onclick="event.stopPropagation(); change(936,-1)" id="btn-936-minus">âˆ’</button>
                <span id="count-936">0</span>
                <button onclick="event.stopPropagation(); change(936,1)">ï¼‹</button>
            </div>
        </div>
        <div class="milk-card" id="card-1857">
            <div class="card-info">
                <svg width="16" height="18" viewBox="0 0 65 75"><path d="M15 20 Q15 10 32 10 Q50 10 50 20 L50 65 L15 65 Z" fill="#fef2f2" stroke="#ef4444" stroke-width="4"/></svg>
                <span class="size-label">1857</span>
            </div>
            <div class="qty-control">
                <button onclick="event.stopPropagation(); change(1857,-1)" id="btn-1857-minus">âˆ’</button>
                <span id="count-1857">0</span>
                <button onclick="event.stopPropagation(); change(1857,1)">ï¼‹</button>
            </div>
        </div>
    </div>
</div>

<script>
let side = 1;
let data = {
    1: { t: 0, c: { 230: 0, 468: 0, 936: 0, 1857: 0 } },
    2: { t: 0, c: { 230: 0, 468: 0, 936: 0, 1857: 0 } }
};

const config = {
    230:  { color: "#3b82f6", h: 14, p: "M4 6 L8 2 L12 6 L12 18 L4 18 Z" },
    468:  { color: "#22c55e", h: 16, p: "M4 6 L8 2 L12 6 L12 22 L4 22 Z" },
    936:  { color: "#f59e0b", h: 18, p: "M3 6 L10 2 L17 6 L17 26 L3 26 Z" },
    1857: { color: "#ef4444", h: 18, p: "M5 8 Q5 4 12 4 Q19 4 19 8 L19 26 L5 26 Z" }
};

function getIconHtml(ml) {
    const c = config[ml];
    return `<svg width="8" height="${c.h}" viewBox="0 0 22 30" style="flex-shrink:0"><path d="${c.p}" fill="none" stroke="${c.color}" stroke-width="4"/></svg>`;
}

function softReset() {
    data = {
        1: { t: 0, c: { 230: 0, 468: 0, 936: 0, 1857: 0 } },
        2: { t: 0, c: { 230: 0, 468: 0, 936: 0, 1857: 0 } }
    };
    document.getElementById("price-1").value = "";
    document.getElementById("price-2").value = "";
    recalc(1); recalc(2);
    switchSide(1);
}

function switchSide(id) {
    side = id;
    document.getElementById("side-card-1").classList.toggle("active-side", id==1);
    document.getElementById("side-card-2").classList.toggle("active-side", id==2);
    updateUI();
}

function change(ml, delta) {
    data[side].c[ml] += delta;
    if (data[side].c[ml] < 0) data[side].c[ml] = 0;
    if(window.navigator.vibrate) window.navigator.vibrate(10);
    recalc(side);
}

function recalc(s) {
    let total = 0; let html = "";
    for (let ml in data[s].c) {
        let count = data[s].c[ml];
        total += ml * count;
        for (let i = 0; i < count; i++) html += getIconHtml(ml);
    }
    data[s].t = total;
    document.getElementById("vol-" + s).innerText = total;
    document.getElementById("list-" + s).innerHTML = html;
    updateUI(); calc();
}

function updateUI() {
    [230, 468, 936, 1857].forEach(ml => {
        let count = data[side].c[ml];
        document.getElementById("count-" + ml).innerText = count;
        document.getElementById("card-" + ml).classList.toggle("active", count > 0);
        document.getElementById("btn-" + ml + "-minus").disabled = count === 0;
    });
}

function calc() {
    let p1 = parseFloat(document.getElementById("price-1").value);
    let p2 = parseFloat(document.getElementById("price-2").value);
    let u1 = (p1 > 0 && data[1].t > 0) ? (p1 / data[1].t * 100) : null;
    let u2 = (p2 > 0 && data[2].t > 0) ? (p2 / data[2].t * 100) : null;

    const res1 = document.getElementById("unit-1");
    const res2 = document.getElementById("unit-2");
    const winTxt = document.getElementById("win-text");

    res1.innerText = u1 ? `$ ${u1.toFixed(2)} / 100ml` : "";
    res2.innerText = u2 ? `$ ${u2.toFixed(2)} / 100ml` : "";

    if (u1 && u2) {
        if (u1 < u2) { 
            winTxt.innerText = "ğŸ† æ–¹æ¡ˆ A è´äº†!"; winTxt.style.color = "#2563eb";
            res1.style.color = "#16a34a"; res1.style.fontSize = "18px";
            res2.style.color = "#94a3b8"; res2.style.fontSize = "13px";
        } else if (u2 < u1) { 
            winTxt.innerText = "ğŸ† æ–¹æ¡ˆ B è´äº†!"; winTxt.style.color = "#16a34a";
            res2.style.color = "#16a34a"; res2.style.fontSize = "18px";
            res1.style.color = "#94a3b8"; res1.style.fontSize = "13px";
        } else { 
            winTxt.innerText = "å…©é‚Šä¸€æ¨£çœ!"; winTxt.style.color = "#64748b";
            res1.style.color = res2.style.color = "#64748b";
        }
    } else {
        winTxt.innerText = "READY"; winTxt.style.color = "#94a3b8";
        res1.style.color = res2.style.color = "#64748b"; res1.style.fontSize = res2.style.fontSize = "13px";
    }
}

// ç›£è½ Enter åˆ‡æ›
document.getElementById('price-1').addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); switchSide(2); document.getElementById('price-2').focus(); } });
document.getElementById('price-2').addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); e.target.blur(); } });

// é»æ“Šç©ºç™½è™•æ”¶èµ·éµç›¤
document.addEventListener('touchstart', e => { 
    if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'BUTTON') {
        document.activeElement.blur();
    }
}, {passive: true});

// ä¿®æ­£éµç›¤å½ˆå‡ºæ™‚è‡ªå‹•æ»¾å‹•
window.addEventListener('resize', () => {
    if (document.activeElement.tagName === 'INPUT') {
        setTimeout(() => {
            document.activeElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
    }
});
</script>
</body>
</html>
